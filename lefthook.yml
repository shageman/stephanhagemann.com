pre-push:
  parallel: true

min_version: 1.6.1

skip_output:
  - empty_summary
  - execution
  - execution_out
  - execution_info

pre-commit:
  parallel: true
  commands:
    structure-validate-config:
      glob: '*'
      run: echo {all_files} > /dev/null && bin/packwerk validate
    structure-check:
      glob: '*'
      run: echo {all_files} > /dev/null && bin/packwerk check
    structure-visualize:
      glob: '*'
      run: echo {all_files} > /dev/null && visualize_packs > packs.dot && git diff --exit-code --quiet "packs.dot"
    backend-linter:
      glob: "*.rb"
      run: bin/rubocop {all_files} --autocorrect
      stage_fixed: true
    tests:
      glob: '*'
      run: echo {all_files} > /dev/null && bin/rspec
    console-works:
      glob: '*'
      run: echo {all_files} > /dev/null && echo "puts Speaking::Talk.count" | bin/rails c 
    check broken links:
      glob: '*'
      run: "echo {all_files} > /dev/null && wget --spider -r --header='User-Agent: Mozilla/5.0' --output-file=crawl.log --no-verbose http://localhost:3000 2>&1"
